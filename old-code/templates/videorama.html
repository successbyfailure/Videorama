<!DOCTYPE html>
<html lang="es">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>
      {{ app_name }}{% if videorama_version %} v{{ videorama_version }}{% endif %} · Biblioteca retro
    </title>
    <link rel="icon" type="image/png" href="/assets/LogoVideorama.png" />
    <link rel="stylesheet" href="/static/css/videorama.css" />
  </head>
  <body>
    <nav class="top-nav">
      <span class="brand">
        <img class="brand-logo" src="/assets/LogoVideorama.png" alt="Logotipo de Videorama" />
        <span class="brand-name">
          {{ app_name }}
          {% if videorama_version %}
          <span class="version-pill">v{{ videorama_version }}</span>
          {% endif %}
        </span>
      </span>
      <div class="nav-links">
        <a href="/">Biblioteca</a>
        <a href="/jobs">⚡ Tareas</a>
        <a href="/external-player">Player externo</a>
        <a href="/import">Importador</a>
        <a href="/search">Buscar</a>
        <a href="/stats">Estadísticas</a>
        <a href="/telegram">Telegram</a>
        <button type="button" data-open-modal="playlist-modal">Playlists</button>
        <button type="button" data-open-modal="category-modal">Categorías</button>
      </div>
    </nav>
    <div class="app-shell">
      <main>
        <section class="library-hero">
          <div class="library-switch-card">
            <div class="hero-switch">
              <div>
                <p class="eyebrow">Bibliotecas</p>
                <h1>Explora Videorama</h1>
                <p class="library-subtitle" id="library-subtitle">Explorando la biblioteca de video.</p>
              </div>
              <div class="library-switch library-switch-large" aria-label="Selector de biblioteca">
                <div class="switch-group">
                  <button type="button" class="library-pill active" data-library-target="video">Videos</button>
                  <button type="button" class="library-pill" data-library-target="music">Música</button>
                </div>
              </div>
            </div>
            <div class="library-meta">
              <p class="library-subtitle">
                Biblioteca retro con <span id="library-count-label">{{ library_count }}</span> elementos ya clasificados.
                {% if preview_categories %}Destacan: {{ ', '.join(preview_categories) }}.{% endif %}
              </p>
              <div class="meta-badges">
                <span class="meta-pill">
                  Elementos
                  <strong id="library-count-value">{{ '{:,}'.format(library_count).replace(',', '.') }}</strong>
                </span>
                <span class="meta-pill">Favoritos <strong id="favorite-count">0</strong></span>
                <span class="meta-pill">Listas <strong id="playlist-count">0</strong></span>
              </div>
            </div>
          </div>
        </section>
        <section class="controls-panel">
          <div class="controls-grid">
            <article class="control-card search-card">
              <div class="control-header">
                <div>
                  <p class="eyebrow">Búsqueda y filtros</p>
                  <h2>Encuentra contenido al instante</h2>
                </div>
                <div class="control-actions">
                  <button class="ghost-link" type="button" data-open-modal="playlist-modal">Playlists</button>
                  <button class="ghost-link" type="button" data-open-modal="category-modal">Categorías</button>
                </div>
              </div>
              <label for="search">Buscar en tu biblioteca</label>
              <div class="search-row">
                <input
                  type="search"
                  id="search"
                  class="search-input"
                  placeholder="Título, autor, etiqueta o nota"
                  autocomplete="off"
                />
              </div>
              <div class="status-row compact">
                <p id="active-playlist">Mostrando toda la biblioteca.</p>
                <p id="results-counter">0 resultados.</p>
              </div>
            </article>
            <article class="control-card">
              <div class="control-header">
                <div>
                  <h3>Categorías</h3>
                  <p class="hint">Usa las pastillas para acotar el resultado.</p>
                </div>
                <button class="ghost-link" type="button" data-open-modal="category-modal">Preferencias</button>
              </div>
              <div class="chip-group" id="category-chips"></div>
            </article>
            <article class="control-card playlists-card">
              <div class="control-header">
                <div>
                  <h3>Playlists</h3>
                  <p class="hint">Listas rápidas y dinámicas</p>
                </div>
                <button class="ghost-link" type="button" data-open-modal="playlist-modal">Gestionar</button>
              </div>
              <div class="playlist-columns">
                <div>
                  <p class="eyebrow">Listas estáticas</p>
                  <ul id="static-playlists" class="compact-list"></ul>
                </div>
                <div>
                  <p class="eyebrow">Listas dinámicas</p>
                  <ul id="dynamic-playlists" class="compact-list"></ul>
                </div>
              </div>
            </article>
          </div>
        </section>
        <section class="player-panel is-empty" id="player-panel" aria-live="polite">
          <header class="player-panel-header">
            <div>
              <p class="eyebrow">Reproductor principal</p>
              <h2 class="player-title" id="player-title">Elige un video o canción</h2>
              <div class="player-meta">
                <span id="player-uploader"></span>
                <span id="player-category"></span>
                <span id="player-duration"></span>
              </div>
            </div>
            <div class="player-mode player-header-actions" id="player-mode-controls">
              <div class="chip-group" id="music-mode-group" hidden>
                <button type="button" class="chip" data-music-mode="audio">Solo audio</button>
                <button type="button" class="chip active" data-music-mode="auto">Auto (videoclip si hay)</button>
              </div>
              <div class="player-mode-flags">
                <label>
                  <input type="checkbox" id="auto-next-toggle" checked />
                  Seleccionar la siguiente pieza al terminar
                </label>
                <label>
                  <input type="checkbox" id="auto-pick-toggle" checked />
                  Elegir automáticamente si no hay elección manual
                </label>
              </div>
              <div class="next-picker" id="next-picker" hidden>
                <label for="next-entry-select">Siguiente sugerido</label>
                <div class="next-picker-row">
                  <select id="next-entry-select"></select>
                  <button type="button" id="play-next-now">Reproducir</button>
                </div>
              </div>
            </div>
          </header>
          <div class="player-layout">
            <div class="player-column">
              <div class="player-preview">
                <div class="player-placeholder" id="player-placeholder">Selecciona algo para comenzar la reproducción.</div>
                <video id="player-video" controls preload="metadata" poster=""></video>
              </div>
              <h3 class="player-section-title" id="player-notes-heading">Resumen</h3>
              <p class="player-notes" id="player-notes"></p>
              <div class="player-tags" id="player-tags"></div>
              <section class="player-sections">
                <h3>Ficha técnica</h3>
                <dl class="metadata-grid" id="player-facts"></dl>
              </section>
              <section class="player-sections">
                <h3>Metadatos originales</h3>
                <dl class="metadata-grid" id="player-metadata"></dl>
              </section>
              <details class="download-menu" id="player-download-menu">
                <summary>Descargas y recodificación</summary>
                <div class="download-menu-body">
                  <label for="player-format">Formato de descarga</label>
                  <select class="format-select" id="player-format"></select>
                  <div class="menu-actions">
                    <a class="primary-button" id="player-download" target="_blank" rel="noreferrer">Descargar</a>
                    <a class="ghost-link" id="player-source" target="_blank" rel="noreferrer">Ver origen</a>
                  </div>
                </div>
              </details>
            </div>
            <div class="player-column player-controls">
              <section class="player-sections">
                <h3>Miniatura</h3>
                <div class="thumbnail-card">
                  <div class="thumbnail-frame">
                    <img id="player-thumbnail-image" alt="Miniatura del video" loading="lazy" />
                  </div>
                  <p class="hint">Las miniaturas se guardan en caché local y se limpian automáticamente.</p>
                </div>
              </section>
              <section class="player-sections">
                <h3>Editar información</h3>
                <div class="quick-actions">
                  <button class="ghost-link" type="button" id="auto-tags-button">Sugerir etiquetas</button>
                  <button class="ghost-link" type="button" id="auto-summary-button">Sugerir descripción</button>
                  <button class="ghost-link" type="button" id="refresh-thumbnail-button">Regenerar miniatura</button>
                  <button class="ghost-link" type="button" id="refresh-metadata-button">Reescanear metadatos</button>
                </div>
                <p class="status inline" id="edit-status"></p>
                <form id="player-edit-form" class="edit-form">
                  <div class="form-grid">
                    <div>
                      <label for="edit-title">Título</label>
                      <input id="edit-title" name="title" maxlength="300" />
                    </div>
                    <div>
                      <label for="edit-category">Categoría</label>
                      <input id="edit-category" name="category" maxlength="120" />
                    </div>
                  </div>
                  <div>
                    <label for="edit-tags">Etiquetas (separadas por comas)</label>
                    <input id="edit-tags" name="tags" />
                    <div class="tag-suggestions" id="tag-suggestions"></div>
                    <div class="auto-tag-results" id="auto-tag-results"></div>
                  </div>
                  <div>
                    <label for="edit-notes" id="edit-notes-label">Descripción o notas</label>
                    <textarea id="edit-notes" name="notes" maxlength="2000"></textarea>
                  </div>
                  <div class="edit-actions">
                    <button class="primary-button" type="submit">Guardar cambios</button>
                  </div>
                </form>
              </section>
              <div class="player-actions">
                <button class="danger-button" id="player-delete" type="button">Eliminar video</button>
              </div>
            </div>
          </div>
        </section>
        <section id="library-section">
          <div class="library-grid" id="library-grid"></div>
          <div class="empty-state" id="empty-state" hidden>
            Nada coincide con tu búsqueda o filtros. Intenta otra combinación o vuelve a "Todos".
          </div>
        </section>
      </main>
    </div>
    <div class="modal" id="playlist-modal" aria-hidden="true">
      <div class="modal-content">
        <header class="modal-header">
          <div>
            <h2>Gestor de playlists</h2>
            <p class="hint">Crea listas estáticas con tu selección o define búsquedas automáticas.</p>
          </div>
          <button class="modal-close" type="button" data-close-modal>&times;</button>
        </header>
        <div class="modal-body">
          <div class="manager-grid">
            <article class="manager-card">
              <h3>Lista estática</h3>
              <form id="static-playlist-form">
                <label for="static-playlist-name">Nombre</label>
                <input id="static-playlist-name" required maxlength="80" />
                <label for="static-playlist-description">Descripción</label>
                <textarea id="static-playlist-description" maxlength="200"></textarea>
                <p class="hint">Se guardarán los vídeos visibles actualmente en la cuadrícula.</p>
                <button type="submit">Guardar selección actual</button>
                <p class="status" id="static-playlist-status"></p>
              </form>
            </article>
            <article class="manager-card">
              <h3>Lista dinámica</h3>
              <form id="dynamic-playlist-form">
                <label for="dynamic-playlist-name">Nombre</label>
                <input id="dynamic-playlist-name" required maxlength="80" />
                <label for="dynamic-playlist-description">Descripción</label>
                <textarea id="dynamic-playlist-description" maxlength="200"></textarea>
                <label for="dynamic-rule-type">Tipo de regla</label>
                <select id="dynamic-rule-type">
                  <option value="tag">Etiqueta</option>
                  <option value="category">Categoría</option>
                  <option value="uploader">Autor</option>
                  <option value="duration_min">Duración mínima (minutos)</option>
                  <option value="duration_max">Duración máxima (minutos)</option>
                </select>
                <label for="dynamic-rule-term">Valor o término</label>
                <input id="dynamic-rule-term" placeholder="Etiqueta, categoría o autor" />
                <label for="dynamic-rule-minutes">Minutos (si aplica)</label>
                <input id="dynamic-rule-minutes" type="number" min="1" step="1" />
                <button type="submit">Crear lista dinámica</button>
                <p class="status" id="dynamic-playlist-status"></p>
              </form>
            </article>
          </div>
          <section>
            <h3>Listas personalizadas</h3>
            <ul class="manager-list" id="custom-playlists"></ul>
          </section>
        </div>
      </div>
    </div>
    <div class="modal" id="category-modal" aria-hidden="true">
      <div class="modal-content">
        <header class="modal-header">
          <div>
            <h2>Gestor de categorías</h2>
            <p class="hint">Renombra o esconde categorías sin perder el material original.</p>
          </div>
          <button class="modal-close" type="button" data-close-modal>&times;</button>
        </header>
        <div class="modal-body">
          <form id="category-settings-form">
            <div class="manager-list" id="category-manager-list"></div>
            <div class="manager-actions">
              <button type="submit">Guardar preferencias</button>
            </div>
            <p class="status" id="category-manager-status"></p>
          </form>
        </div>
      </div>
    </div>

<script src="/static/js/videorama.js"></script>

    <!-- Videorama Async Features -->
    <script src="/assets/videorama-async.js"></script>
    <script src="/assets/videorama-ux-improvements.js"></script>

  </body>
</html>
